<!DOCTYPE html>
<html>
<head>
    <title>MikroTik Route Builder</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background:#0f172a;
            color:#e2e8f0;
            padding:20px;
        }
        input, textarea {
            width:100%;
            margin:8px 0;
            padding:10px;
            background:#1e293b;
            color:white;
            border:1px solid #334155;
        }
        button {
            padding:10px;
            background:#2563eb;
            border:none;
            color:white;
            cursor:pointer;
        }
        .terminal {
            background:black;
            color:#00ff00;
            padding:10px;
            margin-top:20px;
            height:220px;
            overflow:auto;
            font-family:monospace;
        }
        .summary {
            margin-top:15px;
            background:#1e293b;
            padding:10px;
            white-space: pre-line;
        }
        hr {
            border-color: #334155;
        }
    </style>
</head>
<body>

<h2>MikroTik Route Builder</h2>

<label>Router IP</label>
<input id="router_ip" placeholder="192.168.88.1">

<label>Router Username</label>
<input id="username" placeholder="admin">

<label>Router Password</label>
<input id="password" type="password">

<hr>

<label>Gateway</label>
<input id="gateway" placeholder="192.168.88.1">

<label>Routing Table</label>
<input id="table" placeholder="main">

<label>CIDR File</label>
<input type="file" id="file">

<button onclick="buildRoutes()">Build Routes From File</button>

<div class="summary" id="summary"></div>

<textarea id="command" rows="10" placeholder="Generated commands will appear here..."></textarea>
<button onclick="sendCommand()">Send to Router</button>

<div class="terminal" id="terminal"></div>

<script>
async function buildRoutes() {
    let formData = new FormData();
    const fileInput = document.getElementById("file").files[0];
    if(!fileInput) {
        alert("Please select a CIDR file!");
        return;
    }
    formData.append("file", fileInput);
    formData.append("gateway", document.getElementById("gateway").value);
    formData.append("table", document.getElementById("table").value);

    let res = await fetch("/build", {
        method: "POST",
        body: formData
    });

    let data = await res.json();

    if(data.error) {
        document.getElementById("summary").innerText = "Error: " + data.error;
        document.getElementById("command").value = "";
        return;
    }

    document.getElementById("summary").innerText =
        "Unique routes: " + data.valid.length +
        "\nDuplicates: " + data.duplicates.length +
        "\nInvalid: " + data.invalid.length;

    document.getElementById("command").value = data.commands;
}

async function sendCommand() {
    const router_ip = document.getElementById("router_ip").value;
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;
    const command = document.getElementById("command").value;

    if(!router_ip || !username || !password || !command) {
        alert("Please fill all fields and generate commands first!");
        return;
    }

    let res = await fetch("/run", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ router_ip, username, password, command })
    });

    let data = await res.json();
    document.getElementById("terminal").innerText = data.output;
}
</script>

</body>
</html>
